flowchart TB
    %% –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    User((üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å))
    
    %% –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–≥—Ä–∞—Ñ–æ–≤ - —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
    
    %% –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (–≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)
    subgraph ExternalServices["–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã"]
        direction LR
        TelegramAPI[Telegram API]
        YandexSTT[Yandex STT]
        S3[(AWS S3)]
        OpenAI[OpenAI API]
        NotionAPI[Notion API]
    end
    
    %% –°–ª–æ–π –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ - UI Controllers
    subgraph UIControllers["–°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (UI Controllers)"]
        direction LR
        TelegramController[Telegram<br>Controller]
        VoiceController[Voice<br>Controller]
        SchemaController[Schema<br>Controller]
        ResultController[Result<br>Controller]
    end
    
    %% –°–ª–æ–π –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ - External Adapters
    subgraph ExternalAdapters["–°–ª–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ê–¥–∞–ø—Ç–µ—Ä—ã)"]
        direction LR
        YandexSTTAdapter[Yandex STT<br>Adapter]
        S3Adapter[S3<br>Adapter]
        SchemaDBAdapter[Schema DB<br>Adapter]
        OpenAIAdapter[OpenAI<br>Adapter]
        NotionAdapter[Notion<br>Adapter]
    end
    
    %% –°–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - Use Cases
    subgraph ApplicationLayer["–°–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Use Cases)"]
        direction LR
        RecognizeVoiceUseCase[Recognize Voice<br>Use Case]
        DetectSchemaUseCase[Detect Schema<br>Use Case]
        ExtractFieldsUseCase[Extract Fields<br>Use Case]
        CreateDocumentUseCase[Create Document<br>Use Case]
    end
    
    %% –ü–æ—Ä—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    subgraph Ports["–ü–æ—Ä—Ç—ã (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)"]
        direction LR
        StoragePort[[Storage<br>Port]]
        RecognitionPort[[Recognition<br>Port]]
        SchemaPort[[Schema<br>Port]]
        AIPort[[AI<br>Port]]
        DocumentPort[[Document<br>Port]]
    end
    
    %% –î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π (—Ü–µ–Ω—Ç—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
    subgraph DomainLayer["–î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π (–Ø–¥—Ä–æ)"]
        direction LR
        VoiceRecord[Voice<br>Record]
        RecognitionResult[Recognition<br>Result]
        Schema[Schema]
        Document[Document]
    end
    
    %% –®–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π (–æ—Ç–¥–µ–ª—å–Ω–æ)
    EventBus{{"–®–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π"}}
    
    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    User <--> TelegramAPI
    
    %% –°–≤—è–∑–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏
    TelegramAPI <--> TelegramController
    YandexSTT <--> YandexSTTAdapter
    S3 <--> S3Adapter
    OpenAI <--> OpenAIAdapter
    NotionAPI <--> NotionAdapter
    
    %% –°–≤—è–∑–∏ UI –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Å —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ use cases
    TelegramController -->|"1.–ì–æ–ª–æ—Å–æ–≤–æ–µ<br>—Å–æ–æ–±—â–µ–Ω–∏–µ"| EventBus
    EventBus -->|"2.–û–±—Ä–∞–±–æ—Ç–∞—Ç—å<br>–≥–æ–ª–æ—Å–æ–≤–æ–µ"| VoiceController
    VoiceController -->|"3.–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å<br>–≥–æ–ª–æ—Å"| RecognizeVoiceUseCase
    
    %% –°–≤—è–∑–∏ Use Cases —Å –ø–æ—Ä—Ç–∞–º–∏
    RecognizeVoiceUseCase -->|"4.–°–æ—Ö—Ä–∞–Ω–∏—Ç—å<br>—Ñ–∞–π–ª"| StoragePort
    RecognizeVoiceUseCase -->|"5.–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å<br>—Ä–µ—á—å"| RecognitionPort
    
    %% –°–≤—è–∑–∏ –ø–æ—Ä—Ç–æ–≤ —Å –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏
    StoragePort --> S3Adapter
    RecognitionPort --> YandexSTTAdapter
    
    %% –†–∞–±–æ—Ç–∞ —Å –¥–æ–º–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
    RecognizeVoiceUseCase -->|"6.–°–æ–∑–¥–∞–µ—Ç"| VoiceRecord
    RecognizeVoiceUseCase -->|"7.–°–æ–∑–¥–∞–µ—Ç"| RecognitionResult
    
    %% –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é —Å—Ö–µ–º—ã
    RecognizeVoiceUseCase -->|"8.–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å<br>—Å—Ö–µ–º—É"| DetectSchemaUseCase
    
    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ—Ä—Ç–∞–º–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã
    DetectSchemaUseCase -->|"9.–ü–æ–ª—É—á–∏—Ç—å<br>—Å—Ö–µ–º—ã"| SchemaPort
    DetectSchemaUseCase -->|"10.–ê–Ω–∞–ª–∏–∑<br>—Ç–µ–∫—Å—Ç–∞"| AIPort
    
    %% –°–≤—è–∑–∏ –ø–æ—Ä—Ç–æ–≤ —Å –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã
    SchemaPort --> SchemaDBAdapter
    AIPort --> OpenAIAdapter
    
    %% –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ö–µ–º—ã —á–µ—Ä–µ–∑ UI
    DetectSchemaUseCase -->|"11.–ó–∞–ø—Ä–æ—Å<br>–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"| EventBus
    EventBus -->|"12.–ü–æ–∫–∞–∑–∞—Ç—å<br>–≤–∞—Ä–∏–∞–Ω—Ç—ã"| SchemaController
    SchemaController -->|"13.–û—Ç–æ–±—Ä–∞–∑–∏—Ç—å<br>–≤–∞—Ä–∏–∞–Ω—Ç—ã"| TelegramController
    TelegramController -->|"14.–ó–∞–ø—Ä–æ—Å–∏—Ç—å<br>–≤—ã–±–æ—Ä"| TelegramAPI
    
    %% –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    TelegramAPI -->|"15.–í—ã–±–æ—Ä<br>–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"| TelegramController
    TelegramController -->|"16.–°—Ö–µ–º–∞<br>–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞"| EventBus
    EventBus -->|"17.–û–±—Ä–∞–±–æ—Ç–∞—Ç—å<br>–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"| SchemaController
    SchemaController -->|"18.–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å<br>—Å—Ö–µ–º—É"| DetectSchemaUseCase
    
    %% –†–∞–±–æ—Ç–∞ —Å –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é —Å—Ö–µ–º—ã
    DetectSchemaUseCase -->|"19.–í—ã–±–∏—Ä–∞–µ—Ç"| Schema
    
    %% –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    DetectSchemaUseCase -->|"20.–ò–∑–≤–ª–µ—á—å<br>–ø–æ–ª—è"| ExtractFieldsUseCase
    ExtractFieldsUseCase -->|"21.–ê–Ω–∞–ª–∏–∑<br>—Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ"| AIPort
    ExtractFieldsUseCase -->|"22.–°–æ–∑–¥–∞—Ç—å<br>–¥–æ–∫—É–º–µ–Ω—Ç"| CreateDocumentUseCase
    
    %% –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Notion
    CreateDocumentUseCase -->|"23.–°–æ–∑–¥–∞–µ—Ç"| Document
    CreateDocumentUseCase -->|"24.–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"| DocumentPort
    DocumentPort --> NotionAdapter
    
    %% –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
    CreateDocumentUseCase -->|"25.–î–æ–∫—É–º–µ–Ω—Ç<br>—Å–æ–∑–¥–∞–Ω"| EventBus
    EventBus -->|"26.–£–≤–µ–¥–æ–º–∏—Ç—å<br>–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ"| ResultController
    ResultController -->|"27.–û—Ç–ø—Ä–∞–≤–∏—Ç—å<br>—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"| TelegramController
    TelegramController -->|"28.–ü–æ–∫–∞–∑–∞—Ç—å<br>—Ä–µ–∑—É–ª—å—Ç–∞—Ç"| TelegramAPI
    TelegramAPI -->|"29.–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"| User
    
    %% –ù–µ—è–≤–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–æ–º–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ (–æ—Ç–Ω–æ—à–µ–Ω–∏—è)
    VoiceRecord -.-> RecognitionResult
    RecognitionResult -.-> Schema
    Schema -.-> Document
    
    %% –°—Ç–∏–ª–∏ —Å–ª–æ–µ–≤
    classDef domainLayer fill:#f9d4d4,stroke:#d10505,color:#333
    classDef applicationLayer fill:#ffe6cc,stroke:#d79b00,color:#333
    classDef portsLayer fill:#fff2cc,stroke:#d6b656,color:#333
    classDef adaptersLayer fill:#dae8fc,stroke:#6c8ebf,color:#333
    classDef uiLayer fill:#d5e8d4,stroke:#82b366,color:#333
    classDef externalLayer fill:#f5f5f5,stroke:#666666,color:#333
    classDef eventBusStyle fill:#e1d5e7,stroke:#9673a6,color:#333
    
    class DomainLayer,VoiceRecord,RecognitionResult,Schema,Document domainLayer
    class ApplicationLayer,RecognizeVoiceUseCase,DetectSchemaUseCase,ExtractFieldsUseCase,CreateDocumentUseCase applicationLayer
    class Ports,StoragePort,RecognitionPort,SchemaPort,AIPort,DocumentPort portsLayer
    class ExternalAdapters,YandexSTTAdapter,S3Adapter,SchemaDBAdapter,OpenAIAdapter,NotionAdapter adaptersLayer
    class UIControllers,TelegramController,VoiceController,SchemaController,ResultController uiLayer
    class ExternalServices,TelegramAPI,YandexSTT,S3,OpenAI,NotionAPI externalLayer
    class EventBus eventBusStyle
